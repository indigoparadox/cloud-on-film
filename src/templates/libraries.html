{% extends 'base.html' %}

{% set arrow_right = url_for( 'static', filename='arrow-right-64.png' ) %}
{% set arrow_left = url_for( 'static', filename='arrow-left-64.png' ) %}

{% block scripts %}
<link rel="stylesheet" href="{{ url_for( 'static', filename='featherlight.min.css' ) }}" />
<link rel="stylesheet" href="{{ url_for( 'static', filename='featherlight.gallery.min.css' ) }}" />
<link rel="stylesheet" href="{{ url_for( 'static', filename='gallery.css' ) }}" />
<script src="{{ url_for( 'static', filename='jquery.unveil2.min.js' ) }}"></script>
<script src="{{ url_for( 'static', filename='featherlight.min.js' ) }}"></script>
<script src="{{ url_for( 'static', filename='featherlight.gallery.min.js' ) }}"></script>
<script type="application/javascript">
$().ready( function() {
   $('.libraries-thumbnail-wrapper')
      .on( 'loading.unveil', function() {
         $(this).css( 'opacity', '0' );
      } )
      .on( 'loaded.unveil', function() {
         $(this).animate( { 'opacity': '1' } );
      } )
      .unveil( {
         'offset': 200,
         'debug': true,
         //'placeholder': "{{ url_for( 'static', filename='art-palette-72.png' ) }}"
      } );
   
   $('a.thumbnail')
      .each( function( elem ) {
         $(this).attr( 'href', $(this).data( 'fullsize' ) );
      } )
      .featherlightGallery( {
         'type': 'image',
         'previousIcon': '<img src="{{ arrow_left }}" alt="Previous" />',
         'nextIcon': '<img src="{{ arrow_right }}" alt="Next" />',
      } );

} );
</script>
{% endblock %}

{% block sidebar %}

<h2>Libraries</h2>
{% with libraries = enumerate_libs() %}
<ul class="libraries">
{% for lib in libraries %}
{% if lib.machine_name == library_name %}
<li class="active">
{% else %}
<li></li>
{% endif %}
<a href="{{ url_for( 'cloud_libraries', machine_name='{{ lib.machine_name }}', relative_path=None ) }}">{{ lib.display_name }}</a>
</li>
{% endfor %}
</ul>
{% endwith %}

{% endblock %}

{% block content %}

<div id="folders" class="w-100 row">
{% for item in folders %}
<div class="folder">
<a href="{{ url_for( 'cloud_libraries', machine_name=item.library.machine_name, relative_path=None ) }}/{{ build_folder_path( item.id ) }}">{{ item.display_name }}</a></div>
{% endfor %}
</div> <!-- /row -->

<div id="pictures" class="row">
{% for item in pictures %}
{% if item.filetype == 'picture' %}
<div class="col-md-2 col-sm-4 coll-xs-6 px-0 card bg-secondary">

{% set img_href = url_for(
   'cloud_libraries', machine_name=item.folder.library.machine_name,
   relative_path=None ) + '/' + build_folder_path( item.folder_id ) + '/' +
   item.display_name %}
<div class="px-0 py-0 libraries-thumbnail-wrapper"
   data-src="{{ url_for( 'cloud_plugin_preview', file_id=item.id ) }}">
<a href="{{ img_href }}" class="thumbnail"
   data-fullsize="{{ url_for( 'cloud_plugin_fullsize', file_id=item.id ) }}">
<noscript>
<img
   class="img-responsive libraries-thumbnail"
   src="{{ url_for( 'cloud_plugin_preview', file_id=item.id ) }}"
   alt="{{ item.display_name }}" />
</noscript>
</a>
</div> <!-- /libraries-thumbnail-wrapper -->

<form action="{{ url_for( 'cloud_edit_filedata' ) }}" method="POST">

<div class="card-body d-flex flex-column">

<!-- body text -->
<h3 class="card-title">{{ item.display_name }}</h3>
<p class="card-text">
{{ item.comment }}
</p>

<!-- button bar -->
<div class="d-flex">
{% if item.nsfw %}
<small class="text-muted nsfw">
NSFW
</small>
{% endif %}
<small class="text-muted rating">
{{ item.rating }}
</small>
</div>

</div> <!-- /card-body -->

</form>
</div> <!-- /card -->
{% endif %}
{% endfor %}
</div> <!-- /row -->

{% endblock %}
